---
title: 'Data Challenge: Netflix'
author: "Mitchelle Mojekwu"
date: "5/7/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages}
library(broom)
library(knitr)
library(tidyverse)
library(ggfortify)
library(readr)
library(stringi)
library(usethis)
```

## EDA
```{r}
#read csv
netflix <- read_csv("netflix_titles.csv")

#year added to netflix column added (ranges from 2014-2021)
netflix <- netflix %>% 
  mutate(year_added = as.integer(stri_sub(date_added, -4,-1)),
         release_year = as.integer(release_year),
         country = factor(country))
glimpse(netflix)
  
```

```{r}
#ggplot(data = netflix, aes(x = year_added, y = #duration))
```


```{r}
#1 TV shows and movies overtime

ggplot(data = netflix, mapping = aes(x = year_added, fill = type)) + geom_bar() + scale_fill_manual(values = c("grey", "blue")) + labs(title = "Type of Content Added Overtime",x = "Year Added to Netflix", y = "Count", fill = "Type of Content")

#ggplot(netflix, aes(x = year_added, color = type)) + geom_density() + theme(axis.text = element_text(angle = 50, hjust = 1))

```


```{r}
#2 countries overtime

#top 10 countries based on frequency of content
x <- list("United States", "India", "United Kingdom", "Japan", "South Korea", "Canada", "Spain", "France", "Mexico", "Egypt")
top_10_c <- netflix %>% 
  filter(country %in% x,)

#overtime trends of content by country
ggplot(top_10_c, aes(x = year_added)) + geom_bar() + facet_wrap(.~country) + theme(axis.text = element_text(angle = 50, hjust = 1)) + labs(title = "Distribution of Content Overtime", subtitle = "by Country", x = "Year Added", y = "Count")

#overtime trends of movie/tv shows by country
ggplot(top_10_c, aes(x = year_added, fill = type)) + geom_bar() + facet_wrap(.~country) + theme(axis.text = element_text(angle = 50, hjust = 1)) + labs(title = "Distribution of Content Overtime", subtitle = "by Country", x = "Year Added", y = "Count")

```
```{r}
#3 genre overtime

netflix <- netflix %>% 
  filter(!is.na(listed_in))


genres<-netflix%>%
  select(listed_in)%>%
  separate(listed_in, into = c('genre1','genre2','genre3'),", ", convert = TRUE)

genres<-genres%>%unlist()

list_in<-tibble(
  list_in=genres)

genre_data <- list_in%>%
  group_by(list_in)%>%
  count()%>%
  filter(!is.na(list_in) && n>=600)



ggplot(genre_data, aes(n, reorder(list_in, fun=median, n)))+geom_histogram(stat = 'identity', show.legend = F)+
  labs(
    x='Count',
    y='Genre of Content',
    title='Distribution of Genre of Content') + coord_flip() + theme(axis.text = element_text(angle = 50, hjust = 1))

```


```{r}
#4 duration overtime (shows then movies)

#split data into shows and movies
shows <- netflix %>% 
  filter(type == "TV Show") %>% 
  mutate(num_seasons = as.integer(substring(duration,-5,1)),
         year_added = factor(year_added))

movies <- netflix %>% 
  filter(type == "Movie",
         !is.na(duration)) %>% 
  mutate(num_mins = as.integer(stri_sub(duration,1, -5)),
         year_added = factor(year_added))

movies <- movies %>% 
  group_by(year_added) %>% 
  mutate(mean_dur = mean(num_mins),
         sd_dur = sd(num_mins))

ggplot(data = shows, mapping = aes(x = num_seasons)) + geom_histogram() + labs(title = "Distribution of Duration for TV Shows", x = "Number of Seasons", y = "Count")

ggplot(data = movies, mapping = aes(x = num_mins)) + geom_histogram() + labs(title =  "Distribution of Duration for Movies", x = "Duration of Movie (Minutes)", y = "Count")


#because the distribution of shows is skewed we should use a box plot because it showcases the median duration and IQR 
ggplot(data = shows,mapping = aes(x = year_added, y = num_seasons)) + geom_boxplot(color = "black", fill = "cornflowerblue") + labs(title = "Year Added vs Duration of Show", x = "Year Show Added to Netflix", y = "Duration of Show (Seasons)") + theme(axis.text = element_text(angle = 50, hjust = 1)) + scale_y_continuous(breaks = c(1,2,3,4,5,6,7,8,9,10))


#because the distribution of movies is relatively normal we can use a histogram of the mean duration of the movies overtime
#ggplot(data = movies,aes(x = year_added, y = num_mins, fill = year_added)) + geom_boxplot(color = "black", fill = "cornflowerblue") + labs(title = "Year Added vs Duration of Movie", x = "Year Show Added to Netflix", y = "Duration of Movie (Minutes)") + theme(axis.text = element_text(angle = 50, hjust = 1))


#ggplot(data = movies, aes(x = year_added, y = mean_dur)) + geom_point(color= "steelblue") + labs(title = "Year Added vs Mean Duration of Movies", x = "Year Movie Added to Netflix", y = "Mean Duration of Movies (Minutes)")

ggplot(movies, aes(x=year_added, y=mean_dur)) +
  geom_bar(position=position_dodge(), stat="identity",
           fill="steelblue") +
  geom_errorbar(aes(ymin=mean_dur-sd_dur, ymax=mean_dur+sd_dur), width=.2) + labs(title = "Year Added vs Duration of Movie", x = "Year Movie Added to Netflix", y = "Duration of Movie (Minutes)")+ theme(axis.text = element_text(angle = 50, hjust = 1))




```


```{r}

```



```{r}
#5 directors overtime

#top 10 directors in all content

netflix %>% 
  group_by(director) %>% 
  filter(!is.na(director)) %>% 
  count() %>% 
  arrange(desc(n))

x2 <- list("Rajiv Chilaka", "RaÃºl Campos, Jan Suter", "Marcus Raboy", "Suhas Kadav", "Jay Karas", "Cathy Garcia-Molina", "Jay Chapman", "Martin Scorsese", "Youssef Chahine", "Steven Spielberg")

top_10_d <-netflix %>% 
  filter(director %in% x2)
glimpse(top_10_d)

ggplot(data = top_10_d, aes(x = year_added, y=director)) +geom_boxplot() + labs(title = "Year Added vs Director", x = "Year Added to Netflix", y = "Director")

ggplot(data = top_10_d, mapping = aes(x = year_added, fill = director)) + geom_bar(position = "fill")+ labs(title = "Year Added vs Proportion of Director", x = "Year Added to Netflix", y = "Director")

```

```{r}
#6 actors overtime
#HAVE TO FIGURE OUT HOW TO SPLIT UP CAST BY ACTORS!!
```

```{r}
#create model that shows which attributes of a show lead to more seasons!
# figure out how to split up countries to use to create model that shows which aspects of a movie leads to appearances in more countries!!
```


```{r}
#??2
#both_country_count <- netflix %>% 
#  filter(!is.na(country)) %>% 
#  group_by(country) %>% 
#  count() %>% 
#  arrange(desc(n))
#glimpse(both_country_count)




#bar plot on the count of movies and shows within top 10 countries
ggplot(top_10_c, aes(x = country, fill = type)) +
    geom_bar() +
    theme_classic()+ theme(axis.text = element_text(angle = 50, hjust = 1))

#bar plot on the proportions of movies and shows within top 10 countries
ggplot(top_10_c, aes(x = country, fill = type)) +
    geom_bar(position = "fill") +
    theme_classic()+ theme(axis.text = element_text(angle = 50, hjust = 1))

#ggplot(data.frame(both_country_count), aes(x=country)) +
  #geom_bar()
```











```{r}

#split data into shows and movies
shows <- netflix %>% 
  filter(type == "TV Show") %>% 
  mutate(num_seasons = as.integer(substring(duration,-5,1)))
  

movies <- netflix %>% 
  filter(type == "Movie")
glimpse(shows)
glimpse(movies)

#all data entries are <chr>"



```


## Possible Useful Variables
Shows:
- country
- date_added
- release_year
- duration (# of seasons)
  *dependent (measure of success)
- rating
- listed_in (genre)
  Most popular:
  - Drama
  - Documentary
  - Comedy
  
  
*most shows did not have a director listed

Movies:
- director
- country
  *dependent (measure of success)
- date_added
- release_year
- rating 
- duration (# of minutes)
- listed_in (genre)
  Most Popular:
  - Comedy
  - Animation
  - Drama
  
https://www.whats-on-netflix.com/news/what-movie-tv-genres-perform-well-in-the-netflix-top-10s/




## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
